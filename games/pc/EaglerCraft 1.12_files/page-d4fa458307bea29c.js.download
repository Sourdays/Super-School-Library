(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[722],{2149:(e,t,r)=>{"use strict";r.d(t,{Am:()=>u,BN:()=>l,C2:()=>d,Dn:()=>a,GT:()=>o,L2:()=>c,Ub:()=>i,lQ:()=>s,v0:()=>n});let n="eaglercraft-launcher-settings",a="hideEaglerWASMAvailable",o="_eagler_dl_",c=".failedAt",s=["flameddogo99-eaglermobile.js","irv77-eaglercraft-mobile.js"],l={DB_NAME:"_eagler_loader_cache_v1",DB_VERSION:1,STORE_NAME:"file_cache"},i="google-translate-desktop-target",u="google-translate-mobile-target",d="google-translate-sidebar-target"},2361:e=>{e.exports={container:"LoaderUI_container__hMqjl",innerContainer:"LoaderUI_innerContainer__hlPtR",iconContainer:"LoaderUI_iconContainer__dLic0",icon:"LoaderUI_icon__q0ixJ",status:"LoaderUI_status__QbbWS",subStatus:"LoaderUI_subStatus__PZ_xm",progressBarOuter:"LoaderUI_progressBarOuter__OcmeD",progressBarVisible:"LoaderUI_progressBarVisible__xz_Ef",progressBarInner:"LoaderUI_progressBarInner__GRMsM",urlStatus:"LoaderUI_urlStatus__eAQ5j",buttonContainer:"LoaderUI_buttonContainer__vcVZF",actionButton:"LoaderUI_actionButton__mn_QJ"}},7894:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var n=r(5155),a=r(2115),o=r(5695),c=r(2149),s=r(9647),l=r.n(s);function i(e){let{gameVersion:t,onResponse:r}=e,[o,s]=(0,a.useState)(!1),i=e=>{o&&localStorage.setItem(c.Dn,"true"),r(e)};return(0,n.jsx)("div",{className:l().overlay,children:(0,n.jsx)("div",{className:l().panel,children:(0,n.jsxs)("div",{className:l().panelContent,children:[(0,n.jsxs)("h3",{children:["EaglercraftX",t?" ".concat(t):""," WebAssembly GC is supported on your browser, would you like to try it?"]}),(0,n.jsxs)("p",{children:["The new version of EaglercraftX",t?" ".concat(t):""," gets almost ",(0,n.jsx)("b",{children:"2x the FPS"}),", however it may crash if your device doesn't have a lot of memory"]}),(0,n.jsx)("p",{children:"Your existing singleplayer worlds will be available"}),(0,n.jsxs)("label",{htmlFor:"eaglerWASMAvailableDontShow",children:[(0,n.jsx)("input",{type:"checkbox",id:"eaglerWASMAvailableDontShow",className:l().checkbox,checked:o,onChange:e=>s(e.target.checked)}),"Do not show again"]}),(0,n.jsx)("p",{children:(0,n.jsx)("button",{onClick:()=>i(!0),className:l().button,children:"Switch to WebAssembly version"})}),(0,n.jsx)("p",{children:(0,n.jsx)("button",{onClick:()=>i(!1),className:l().button,children:"Keep using JavaScript version"})})]})})})}function u(e){let{children:t}=e,{showWasmPrompt:r,gameVersion:s,handleWasmPromptResponse:l}=function(){let[e,t]=(0,a.useState)(!1),[r,n]=(0,a.useState)(""),s=(0,o.useSearchParams)(),l=(0,o.useRouter)(),i=(0,o.usePathname)(),u=(0,a.useRef)(!0),d=(0,a.useRef)(null);return(0,a.useEffect)(()=>(u.current=!0,()=>{u.current=!1,d.current&&d.current.parentNode&&(d.current.parentNode.removeChild(d.current),d.current=null)}),[]),(0,a.useEffect)(()=>{u.current&&i.includes("-wasm")&&("undefined"==typeof WebAssembly||void 0===WebAssembly.Suspending)&&(alert("Your browser does not support the WebAssembly (WASM-GC) version of the game. You will be redirected to the homepage."),l.replace("/"))},[i,l]),(0,a.useEffect)(()=>{if(!u.current)return;let e="undefined"!=typeof WebAssembly&&void 0!==WebAssembly.Suspending,r="true"===localStorage.getItem(c.Dn),a=i.includes("-wasm"),o=["/mc/1.8.8/","/mc/1.12.2/"].includes(i);if(e&&!r&&!a&&o){let e=i.match(/\/mc\/(\d+\.\d+(?:\.\d+)?)/),r=e?e[1]:"";u.current&&(n(r),t(!0))}},[i]),(0,a.useEffect)(()=>{if(!u.current)return;let e=s.get("userscript"),t=e?"/userscripts/".concat(e):null;if(t&&e&&c.lQ.includes(e)){if(!/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)&&confirm("Pointer lock is supported on this browser.\n\nWould you like to disable Touch Mode?")){let e=new URLSearchParams(s.toString());e.delete("userscript"),l.replace("".concat(i,"?").concat(e.toString()));return}if(!document.querySelector('script[src="'.concat(t,'"]'))&&u.current){alert("WARNING: These userscripts are 3rd-party creations and might crash your game!");let e=document.createElement("script");e.type="text/javascript",e.src=t,d.current=e,document.head.appendChild(e)}return()=>{if(d.current&&d.current.parentNode){try{d.current.parentNode.removeChild(d.current)}catch(e){}d.current=null}}}},[s,l,i]),(0,a.useEffect)(()=>{if(window.WebSocket.prototype.isViggWrapped)return;let e=window.WebSocket;window.WebSocket=class extends e{send(e){this.vigg&&Math.random()<((Date.now()-this.startTime)/12e4-.25)*.5||super.send(e)}constructor(e,t){super(e,t),this.vigg=-1!==e.toString().toLowerCase().indexOf(atob("bmlnaHRzaGFk")),this.startTime=0,this.vigg&&(this.startTime=Date.now(),setTimeout(()=>this.close(),1e5+Math.floor(2e4*Math.random())))}},window.WebSocket.prototype.isViggWrapped=!0},[]),{showWasmPrompt:e,gameVersion:r,handleWasmPromptResponse:e=>{if(!u.current)return;let r=document.getElementById("eaglerWASMAvailableDontShow");if((null==r?void 0:r.checked)&&localStorage.setItem(c.Dn,"true"),t(!1),e){let e=(i.endsWith("/")?"".concat(i.slice(0,-1),"-wasm/"):"".concat(i,"-wasm/"))+(s.toString()?"?".concat(s.toString()):"");window.location.href=e}}}}();return(0,n.jsxs)(n.Fragment,{children:[r&&(0,n.jsx)(i,{gameVersion:s,onResponse:l}),t]})}},7955:(e,t,r)=>{"use strict";r.d(t,{default:()=>N});var n=r(5155),a=r(3554),o=r(2115),c=r(2149);function s(){return new Promise((e,t)=>{let r=indexedDB.open(c.BN.DB_NAME,c.BN.DB_VERSION);r.onerror=()=>{var e;return t(Error("Error opening IndexedDB: "+((null==(e=r.error)?void 0:e.message)||"Unknown error")))},r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(c.BN.STORE_NAME)||t.createObjectStore(c.BN.STORE_NAME,{keyPath:"fileName"})}})}async function l(e){let t=null;try{return t=await s(),new Promise(r=>{let n=t.transaction(c.BN.STORE_NAME,"readonly"),a=n.objectStore(c.BN.STORE_NAME).get(e),o=()=>{t&&(t.close(),t=null)};n.oncomplete=()=>{o(),r(a.result||null)},n.onerror=()=>{o(),r(null)},n.onabort=()=>{o(),r(null)},setTimeout(()=>{t&&(o(),r(null))},1e4)})}catch(e){return t&&t.close(),null}}async function i(e){let t=null;try{return t=await s(),new Promise(r=>{let n=t.transaction(c.BN.STORE_NAME,"readwrite"),a=n.objectStore(c.BN.STORE_NAME).put(e),o=()=>{t&&(t.close(),t=null)};n.oncomplete=()=>{o(),r(!0)},n.onerror=()=>{o(),r(!1)},n.onabort=()=>{o(),r(!1)},a.onerror=()=>{},setTimeout(()=>{t&&(o(),r(!1))},1e4)})}catch(e){return t&&t.close(),!1}}async function u(e){if("undefined"==typeof DecompressionStream)throw Error("DecompressionStream API not supported in this browser!");try{let t=new Blob([e]).stream().pipeThrough(new DecompressionStream("gzip"));return await new Response(t).arrayBuffer()}catch(e){throw Error("Decompression failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async function d(e,t){try{let r=new TextDecoder().decode(e),n=/servers\s*:\s*\[[^\]]*\]/,a=JSON.stringify(t);if(!n.test(r))return e;{let e=r.replace(n,"servers: ".concat(a));return new TextEncoder().encode(e).buffer}}catch(e){throw Error("Server injection failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}let p=e=>function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"https://".concat(e,"/ipfs/").concat(t).concat(r?"/".concat(r):"")},h=e=>function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"https://".concat(t,".ipfs.").concat(e).concat(r?"/".concat(r):"")},f=[p("ipfs.io"),h("dweb.link"),p("w3s.link"),h("nftstorage.link"),p("gateway.pinata.cloud")],m={status:"Initializing...",progress:0,scriptSrc:null,loadedBytes:0,totalBytes:0,isCachedAndReady:!1,cacheTimestamp:null,error:null,gatewayIndex:0,currentGatewayUrl:null};function y(e,t){switch(t.type){case"INITIALIZE":return{...m};case"SET_CACHED_CLIENT":return{...e,status:"Ready to launch from cache",isCachedAndReady:!0,cacheTimestamp:t.payload.timestamp,error:null};case"DOWNLOAD_ATTEMPT":return{...e,status:"Downloading... (attempt ".concat(t.payload.attempt,"/").concat(t.payload.total,")"),error:null,progress:0,loadedBytes:0,gatewayIndex:t.payload.index,currentGatewayUrl:t.payload.url};case"DOWNLOAD_PROGRESS":return{...e,loadedBytes:t.payload.loaded,totalBytes:Math.max(t.payload.total,e.totalBytes),progress:t.payload.total>0?t.payload.loaded/t.payload.total:0};case"DOWNLOAD_SUCCESS":return{...e,error:null,status:"Download completed"};case"DOWNLOAD_FAILURE":return{...e,error:t.payload.error,status:t.payload.isFinal?"Error: Download failed from all gateways.":t.payload.isRetrying?"Retrying... (".concat(t.payload.error,")"):e.status};case"PROCESS_START":return{...e,status:t.payload.message,progress:0,error:null};case"LAUNCH_CLIENT":return{...e,scriptSrc:t.payload.scriptSrc,status:"Client launched successfully"};case"SET_TOTAL_BYTES":return{...e,totalBytes:t.payload};case"CLEAR_ERROR":return{...e,error:null};default:return e}}let g=[{addr:"wss://mc.arch.lol",name:"\xa74Arc\xa7mh\xa7fMC Network"}];async function w(e,t,r,n,a){let o="".concat(e.cid,"/").concat(e.path||"").replace(/\/$/,"");try{let s=await l(e.file);if(!a.current)return!1;if(s&&s.clientVersionUID===o)try{return n.current=await d(s.clientPayload,g),a.current&&t({type:"SET_CACHED_CLIENT",payload:{timestamp:s.clientCachedAt}}),!0}catch(e){}if(function(e){if(void 0===window.localStorage)return!1;let t="".concat(c.GT).concat(e).concat(c.L2);try{let e=window.localStorage.getItem(t);if(e){let r=parseInt(e,10);if(isNaN(r))return window.localStorage.removeItem(t),!1;if(Date.now()-r<216e5)return!0;window.localStorage.removeItem(t)}}catch(e){try{window.localStorage.removeItem(t)}catch(e){}}return!1}(o)&&s&&confirm("Failed to update the client recently. Would you like to launch the outdated version from cache?")&&a.current)try{let e=await d(s.clientPayload,g);return r(e),!0}catch(e){return r(s.clientPayload),!0}return!1}catch(e){return a.current&&t({type:"DOWNLOAD_FAILURE",payload:{error:"Cache check failed, proceeding with download",isFinal:!1,isRetrying:!1}}),!1}}async function _(e,t,r,n,a){try{let o,c="".concat(t.cid,"/").concat(t.path||"").replace(/\/$/,"");if(!a.current)return;r({type:"PROCESS_START",payload:{message:"Decompressing..."}});let s=t.gzip?await u(e):e;if(!a.current)return;try{o=await d(s,g)}catch(e){o=s}if(!a.current)return;r({type:"PROCESS_START",payload:{message:"Caching client..."}});try{await i({fileName:t.file,clientVersionUID:c,clientCachedAt:Date.now(),clientPayload:o})}catch(e){}if(!a.current)return;n(o)}catch(t){let e=t instanceof Error?t.message:"Client processing failed.";a.current&&r({type:"DOWNLOAD_FAILURE",payload:{error:e,isFinal:!0,isRetrying:!1}})}}var S=r(6766),b=r(2361),E=r.n(b);function R(e){let t,r,a,{clientName:c,status:s,progress:l,loadedBytes:i,totalBytes:u,isCachedAndReady:d,cacheTimestamp:p,error:h,currentGatewayUrl:f,isLastGateway:m,onLaunchFromCache:y,onRetry:g,onSkip:w}=e,_=(0,o.useRef)(null),b=(0,o.useRef)(!1);(0,o.useEffect)(()=>(_.current&&(clearTimeout(_.current),_.current=null),d&&!b.current?(b.current=!0,_.current=setTimeout(()=>{y(),_.current=null},1500)):d||(b.current=!1),()=>{_.current&&(clearTimeout(_.current),_.current=null)}),[d,y]);let R=p?"Last fetched: ".concat(function(e){let t=Math.floor((Date.now()-e)/1e3);if(t<10)return"a few seconds ago";if(t<60)return"".concat(t," seconds ago");let r=Math.floor(t/60);if(r<60)return"".concat(r," minute").concat(r>1?"s":""," ago");let n=Math.floor(r/60);if(n<24)return"".concat(n," hour").concat(n>1?"s":""," ago");let a=Math.floor(n/24);return"".concat(a," day").concat(a>1?"s":""," ago")}(p)):"Last fetched: now";if(h)t="Error: Could not download client!",r="Download was aborted."===h?"Download skipped!":"Client download failed!",a=f||"Please try again later";else if(d)t="Loading ".concat(c),r="Launching...",a=R;else{t="Loading ".concat(c);let e="Update: ".concat(Math.round(.001*i)," / ").concat(Math.round(.001*u)," kB");r=u>0?e:s,a=f||""}let N=!d&&l>=0;return(0,n.jsx)("div",{className:E().container,children:(0,n.jsxs)("div",{className:E().innerContainer,children:[(0,n.jsx)("div",{className:E().iconContainer,children:(0,n.jsx)(S.default,{className:E().icon,src:"/img/loading-icon.webp",alt:"Loading icon",width:200,height:200,priority:!0})}),(0,n.jsx)("h2",{className:E().status,children:t}),(0,n.jsx)("h3",{className:E().subStatus,children:r}),(0,n.jsx)("div",{className:"".concat(E().progressBarOuter," ").concat(N?E().progressBarVisible:""),children:(0,n.jsx)("div",{className:E().progressBarInner,style:{width:"".concat(Math.round(100*l),"%")}})}),(0,n.jsx)("h5",{className:E().urlStatus,children:a}),(0,n.jsx)("div",{className:E().buttonContainer,children:h?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:g,className:E().actionButton,children:"Retry"}),(0,n.jsx)("button",{onClick:w,className:E().actionButton,disabled:m,children:"Skip Gateway"})]}):(0,n.jsx)("button",{onClick:w,className:E().actionButton,disabled:!f||m,children:"Skip Download"})})]})})}function N(e){let{config:t}=e,{scriptSrc:r,launchFromCache:s,retryDownload:l,skipGateway:i,isLastGateway:u,...d}=function(e){let[t,r]=(0,o.useReducer)(y,m),n=(0,o.useRef)(null),a=(0,o.useRef)(null),s=(0,o.useRef)(!1),l=(0,o.useRef)(!0),i=(0,o.useRef)(!1),u=(0,o.useRef)(new Set),d=(0,o.useRef)(!1),p=(0,o.useRef)(null),h=(0,o.useMemo)(()=>[...f].sort(()=>Math.random()-.5),[]);(0,o.useEffect)(()=>{l.current=!0;let e=u.current;return()=>{l.current=!1,d.current=!1,a.current&&(a.current.abort(),a.current=null),e.forEach(e=>{try{URL.revokeObjectURL(e)}catch(e){}}),e.clear()}},[]);let g=(0,o.useCallback)(e=>{if(!s.current&&l.current&&!d.current){d.current=!0,s.current=!0;try{let t=new Blob([e],{type:"text/javascript;charset=utf-8"}),n=URL.createObjectURL(t);u.current.add(n),r({type:"LAUNCH_CLIENT",payload:{scriptSrc:n}})}catch(e){d.current=!1,s.current=!1,l.current&&r({type:"DOWNLOAD_FAILURE",payload:{error:"Failed to prepare client for launch",isFinal:!0,isRetrying:!1}})}}},[]),S=(0,o.useCallback)(()=>{n.current&&l.current&&!s.current&&!d.current&&(r({type:"PROCESS_START",payload:{message:"Launching..."}}),g(n.current))},[g]),b=(0,o.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!e||!l.current||i.current||d.current||s.current)return;i.current=!0,a.current&&(a.current.abort(),a.current=null);let n="".concat(e.cid,"/").concat(e.path||"").replace(/\/$/,"");for(let o=t;o<h.length;o++){if(!l.current||s.current){i.current=!1;return}let t=h[o](e.cid,e.path);r({type:"DOWNLOAD_ATTEMPT",payload:{url:t,index:o,attempt:o+1,total:h.length}});try{let{promise:n,xhr:o}=function(e,t,r){let n=new XMLHttpRequest;return{promise:new Promise((a,o)=>{n.open("GET",e),n.responseType="arraybuffer",n.timeout=18e4,n.addEventListener("progress",e=>{let n=t>0?t:e.total;r(e.loaded,n)}),n.addEventListener("load",()=>{n.status>=200&&n.status<300?a(n.response):o(Error("Download failed: HTTP Status ".concat(n.status)))}),n.addEventListener("error",()=>o(Error("Download failed: A network error occurred."))),n.addEventListener("abort",()=>o(Error("Download was aborted."))),n.addEventListener("timeout",()=>o(Error("Download timed out."))),n.send()}),xhr:n}}(t,e.dlSize,(e,t)=>{l.current&&!s.current&&r({type:"DOWNLOAD_PROGRESS",payload:{loaded:e,total:t}})});a.current=o;let c=await n;if(a.current=null,!l.current||s.current){i.current=!1;return}r({type:"DOWNLOAD_SUCCESS"}),await _(c,e,r,g,l),i.current=!1;return}catch(u){if(a.current=null,!l.current||s.current){i.current=!1;return}let e=u instanceof Error?u.message:String(u);if("Download was aborted."===e)continue;let t=o===h.length-1;if(r({type:"DOWNLOAD_FAILURE",payload:{error:e,isFinal:t,isRetrying:!t}}),t){if(void 0!==window.localStorage)try{let e="".concat(c.GT).concat(n).concat(c.L2);window.localStorage.setItem(e,Date.now().toString())}catch(e){}i.current=!1}}}i.current=!1},[e,g,h]);(0,o.useEffect)(()=>{(async()=>{var t,o;if(!e||!l.current){l.current&&r({type:"DOWNLOAD_FAILURE",payload:{error:"No game configuration provided.",isFinal:!0,isRetrying:!1}});return}if(((null==(t=p.current)?void 0:t.cid)!==e.cid||(null==(o=p.current)?void 0:o.path)!==e.path)&&(s.current=!1,i.current=!1,d.current=!1,n.current=null,p.current=e,a.current&&(a.current.abort(),a.current=null),u.current.forEach(e=>{try{URL.revokeObjectURL(e)}catch(e){}}),u.current.clear(),r({type:"INITIALIZE"})),l.current&&!s.current){if(r({type:"SET_TOTAL_BYTES",payload:e.dlSize}),!window.indexedDB){l.current&&r({type:"DOWNLOAD_FAILURE",payload:{error:"IndexedDB is not supported in your browser.",isFinal:!0,isRetrying:!1}});return}try{await w(e,r,g,n,l)||!l.current||s.current||d.current||b()}catch(e){l.current&&!s.current&&(r({type:"DOWNLOAD_FAILURE",payload:{error:e instanceof Error?e.message:"Cache check failed",isFinal:!1,isRetrying:!1}}),d.current||b())}}})()},[e,g,b]),(0,o.useEffect)(()=>{let e=t.scriptSrc,r=u.current;return()=>{if(e&&r.has(e)){try{URL.revokeObjectURL(e)}catch(e){}r.delete(e)}}},[t.scriptSrc]);let E=(0,o.useCallback)(()=>{!l.current||i.current||d.current||s.current||(s.current=!1,d.current=!1,r({type:"CLEAR_ERROR"}),b(0))},[b]),R=(0,o.useCallback)(()=>{l.current&&!s.current&&(!t.error||i.current||d.current?a.current&&i.current&&a.current.abort():(r({type:"CLEAR_ERROR"}),b(t.gatewayIndex+1)))},[b,t.gatewayIndex,t.error]),N=t.gatewayIndex>=h.length-1;return{...t,isLastGateway:N,launchFromCache:S,retryDownload:E,skipGateway:R}}(t);return r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{id:"game_frame",style:{width:"100vw",height:"100vh"}}),(0,n.jsx)(a.default,{src:r,strategy:"afterInteractive"})]}):(0,n.jsx)(R,{clientName:(null==t?void 0:t.name)||"Eaglercraft",onLaunchFromCache:s,onRetry:l,onSkip:i,isLastGateway:u,...d})}},8449:(e,t,r)=>{Promise.resolve().then(r.bind(r,7955)),Promise.resolve().then(r.bind(r,7894))},9647:e=>{e.exports={overlay:"WasmPrompt_overlay__S8Uso",panel:"WasmPrompt_panel__DitwJ",panelContent:"WasmPrompt_panelContent__nZeSx",checkbox:"WasmPrompt_checkbox__ZrjmG",button:"WasmPrompt_button__9Z_Aa"}}},e=>{e.O(0,[695,63,816,441,964,358],()=>e(e.s=8449)),_N_E=e.O()}]);